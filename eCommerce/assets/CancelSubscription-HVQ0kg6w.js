import{i as R,j as oe,c as u,t as o,u as c,o as t,d as s,w as n,f as e,e as b,g as C,F as L,a as v,b as $,n as G,h as E,m as J}from"./vue.esm-bundler-Dk_uEpzT.js";import{_ as z}from"./Empty-_Xwqr8fE.js";import{B as j,I as ne}from"./Badge-Bo-XvQ4z.js";import{t as i,a as X,C as B}from"./Translator-Cu_KObU0.js";import{S as H}from"./Str-Dyh8Kh0u.js";import{A as F}from"./Arr-MwYQQ3qa.js";import{U as Y}from"./Url-Cj1PdBAO.js";import{_ as P}from"./DynamicIcon-y7KGaMbT.js";import{_ as q}from"./RouteCell-B9g1hLhs.js";import{O as Z}from"./OrderCustomerInformation-BBcA--td.js";import{R as le}from"./Rest-U7WPPDzn.js";import{n as U}from"./Notify-2R1_bNii.js";import{L as ae}from"./NotFound-_aB0Ut7N.js";import{h as re,a as ee}from"./index-CCpw3JZM.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./common-BfEhDM5f.js";import{d as K}from"./Utils-C64cOWnM.js";const ie=["title"],Q={__name:"ConvertedTime",props:{dateTime:{type:[Object,String],required:!1},withTime:{type:Boolean,required:!1,default:!0},onlyTime:{type:Boolean,required:!1,default:!1}},setup(_){const f=_,d=R("MMM DD");return oe(()=>{f.withTime&&(d.value="MMM DD h:mm A"),f.onlyTime&&(d.value="h:mm A")}),(k,x)=>(t(),u("span",{title:c(K)(_.dateTime,"h:mm A")},o(c(K)(_.dateTime,d.value)),9,ie))}},ce={class:"fc-popover-box"},de={class:"fluent-cart-admin-pages"},ue={class:"fc-popover-content relative overflow-x-auto"},_e={class:"fc-customer-info-list"},me={class:"title"},pe={class:"dot-separator"},fe={class:"text"},he={class:"text"},ve={class:"fc-customer-card fc-popover-box-action"},be={class:"fc-customer-name mr-4 truncate"},ye={class:"fc-popover-box-action-icon"},W={__name:"CustomerInfoPopover",props:{customer:{type:Object,required:!0},toRoute:{type:Object,required:!0}},setup(_){return(f,d)=>{const k=v("router-link"),x=v("el-button"),a=v("el-popover");return t(),u("div",ce,[s(a,{placement:"bottom-start",width:280,trigger:"click"},{reference:n(()=>{var y;return[e("div",ve,[e("div",be,o(((y=_.customer)==null?void 0:y.full_name)||c(i)("No Name")),1),e("div",ye,[s(P,{name:"ChevronDown"})])])]}),default:n(()=>{var y,p,g,M,h;return[e("div",de,[e("div",ue,[e("ul",_e,[e("li",null,[e("span",me,o(((y=_.customer)==null?void 0:y.full_name)||c(i)("No Name")),1)]),e("li",null,[e("div",pe,[e("span",null,[_.customer.purchase_count>0?(t(),u(L,{key:0},[C(o(c(X)(_.customer.purchase_count)),1)],64)):b("",!0),C(" "+o(f.$n("Order","Orders",_.customer.purchase_count??0,"No Order")),1)]),e("span",null,o(_.customer.country_name),1)])]),d[0]||(d[0]=e("li",null,[e("div",{class:"separator"})],-1)),e("li",null,[e("div",fe,[s(k,{to:{name:"view_customer",params:{customer_id:(p=_.customer)==null?void 0:p.id}}},{default:n(()=>{var N;return[C(o((N=_.customer)==null?void 0:N.email),1)]}),_:1},8,["to"])])]),e("li",null,[e("div",he,o((M=(g=_.customer)==null?void 0:g.primary_billing_address)==null?void 0:M.phone),1)])]),s(x,{size:"small",class:"w-full mt-3.5",tag:"router-link",to:{name:"view_customer",params:{customer_id:(h=_.customer)==null?void 0:h.id}}},{default:n(()=>[C(o(f.$t("View Customer")),1)]),_:1},8,["to"])])])]}),_:1}),s(q,{class:"hover:no-underline",to:_.toRoute},{default:n(()=>d[1]||(d[1]=[e("span",null," ",-1)])),_:1,__:[1]},8,["to"])])}}},ge={class:"fc-bulk-delete-action-wrap p-4 pl-5 pt-0"},we={class:"fc-bulk-delete-action-dialog-content space-y-4"},ke={key:0},$e={class:"m-0 mb-2"},Ce={key:0,class:"text-sm text-gray-600 mb-3"},xe={key:1},Oe={class:"m-0 mb-3"},Te={class:"max-h-60 overflow-x-hidden"},Se={class:"font-mono text-sm"},Me={class:"flex items-center justify-end gap-2"},Ie={class:"text-xs"},De={key:2,class:"!mt-2 p-3 bg-gray-50 dark:bg-primary-500 rounded"},Ae={class:"flex justify-between text-sm"},Ne={class:"text-green-600"},Le={class:"text-red-600"},Ve={key:3},Pe={class:"text-sm text-red-600"},Re={class:"flex justify-end"},qe={__name:"BulkDeleteAction",props:{selectedOrders:{type:Array,required:!0},onComplete:{type:Function,default:()=>{}}},setup(_){const f=_,d=R(!1),k=R(0);R(!1);const x=R(!1),a=R([]),y=R(""),p=()=>{a.value=[],k.value=0,y.value=""},g=(r=0)=>{if(!f.selectedOrders.length){p();return}if(r>f.selectedOrders.length-1){setTimeout(()=>{const A=a.value.filter(S=>S.status==="success").length,m=a.value.filter(S=>S.status==="error").length;A>0&&U.success(`${A} orders deleted successfully`),m>0&&U.error(`${m} orders failed to delete`),d.value=!1,y.value=""},500);return}const l=f.selectedOrders[r],V=l.id,T=l.invoice_no;y.value=T;const D=a.value.findIndex(A=>A.id===V);if(l.status==="completed"){D!==-1&&(a.value[D].status="warning",a.value[D].error_message=`Cannot delete order ${T} due to status: completed`),k.value=Math.round((r+1)/f.selectedOrders.length*100),g(r+1);return}D!==-1&&(a.value[D].status="processing"),le.delete("/orders/"+V,{ids:[V]}).then(A=>{D!==-1&&(a.value[D].status="success",a.value[D].invoice_no=A.data.invoice_no),k.value=Math.round((r+1)/f.selectedOrders.length*100),g(r+1)}).catch(A=>{console.log(`Error deleting order ${T} (ID: ${V}):`,A),D!==-1&&(a.value[D].status="error",a.value[D].error_message=A&&A.message||"Unknown error"),k.value=Math.round((r+1)/f.selectedOrders.length*100),g(r+1)})},M=()=>{f.selectedOrders.length&&(d.value=!0,x.value=!0,p(),a.value=f.selectedOrders.map(r=>({id:r.id,invoice_no:r.invoice_no,parent_id:r.parent_id,status:r.status==="completed"?"warning":"pending",error_message:r.status==="completed"?`Cannot delete order ${r.invoice_no} due to status: completed`:""})),g(0))},h=r=>{switch(r){case"success":return"Check";case"error":return"Cross";case"processing":return"Loading";case"warning":return"Warning";default:return"Clock"}},N=r=>{switch(r){case"success":return"text-green-500";case"error":return"text-red-500";case"processing":return"text-blue-500";case"warning":return"text-warning-500";default:return"text-gray-400"}},w=r=>{switch(r){case"success":return i("Success");case"error":return i("Failed");case"processing":return i("Processing...");case"warning":return i("Undeletable");default:return i("Pending")}},I=()=>{x.value=!1,f.onComplete()};return(r,l)=>{const V=v("el-button"),T=v("el-popconfirm"),D=v("el-progress"),A=v("el-table-column"),m=v("el-icon"),S=v("el-table"),se=v("el-dialog");return t(),u("div",ge,[s(T,{title:c(i)("Are you sure you want to delete these orders?"),onConfirm:M,width:"250"},{reference:n(()=>[s(V,{type:"danger",size:"small",loading:d.value,disabled:d.value||!_.selectedOrders.length,class:"flex items-center gap-2"},{default:n(()=>[d.value?(t(),u(L,{key:1},[C(o(c(i)("Deleting...")),1)],64)):(t(),u(L,{key:0},[s(P,{name:"Delete",class:"w-4 h-4"}),C(" "+o(c(i)("Delete Selected (%s)",_.selectedOrders.length)),1)],64))]),_:1},8,["loading","disabled"])]),_:1},8,["title"]),s(se,{modelValue:x.value,"onUpdate:modelValue":l[1]||(l[1]=O=>x.value=O),title:c(i)("Deleting Orders"),width:"800px","close-on-click-modal":!1,"show-close":!1,"close-on-press-escape":!1,"modal-class":"fc-bulk-delete-action-dialog"},{footer:n(()=>[e("div",Re,[s(V,{onClick:l[0]||(l[0]=O=>I()),disabled:d.value,type:"primary"},{default:n(()=>[C(o(d.value?c(i)("Processing..."):c(i)("Done")),1)]),_:1},8,["disabled"])])]),default:n(()=>[e("div",we,[d.value?(t(),u("div",ke,[e("p",$e,o(c(i)("Please do not close or refresh this window. Please wait while we delete the selected orders...")),1),y.value?(t(),u("p",Ce,o(c(i)("Currently processing: %s",y.value)),1)):b("",!0)])):(t(),u("div",xe,[e("p",Oe,o(c(i)("Deletion completed")),1)])),s(D,{percentage:k.value,"stroke-width":6,striped:"","striped-flow":"",class:"mb-4 !mt-0",status:d.value?void 0:"success"},null,8,["percentage","status"]),e("div",Te,[s(S,{data:a.value,class:"w-full",size:"small"},{default:n(()=>[s(A,{label:c(i)("Invoice No."),"min-width":"120"},{default:n(O=>[e("span",Se,o(O.row.invoice_no||O.row.id),1)]),_:1},8,["label"]),s(A,{label:c(i)("Status"),width:"150",align:"right"},{default:n(O=>[e("div",Me,[O.row.status!=="processing"?(t(),$(P,{key:0,name:h(O.row.status),class:G(["w-4 h-4 flex-none ",N(O.row.status)])},null,8,["name","class"])):(t(),$(m,{key:1,class:"is-loading text-blue-500"},{default:n(()=>[s(c(re))]),_:1})),e("span",Ie,[O.row.status=="error"||O.row.status=="warning"?(t(),$(ae,{key:0,title:w(O.row.status),content:O.row.error_message},null,8,["title","content"])):(t(),u(L,{key:1},[C(o(w(O.row.status)),1)],64))])])]),_:1},8,["label"])]),_:1},8,["data"])]),!d.value&&a.value.length?(t(),u("div",De,[e("div",Ae,[e("span",null,o(c(i)("Total"))+": "+o(a.value.length),1),e("span",Ne,o(c(i)("Success"))+": "+o(a.value.filter(O=>O.status==="success").length),1),e("span",Le,o(c(i)("Failed"))+": "+o(a.value.filter(O=>O.status==="error").length),1)])])):b("",!0),a.value.filter(O=>O.status==="warning").length?(t(),u("div",Ve,[e("p",Pe,o(c(i)("We have found some completed orders that are not deletable (%s)",a.value.filter(O=>O.status==="warning").length)),1)])):b("",!0)])]),_:1},8,["modelValue","title"])])}}},He={class:"fc-orders-table-wrap"},Be=["title"],je={key:1},Ee={class:"fc-popover-box"},Fe={class:"fluent-cart-admin-pages"},Ue={class:"fc-popover-content relative overflow-x-auto"},ze={class:"fc-product-orders-items"},Qe={class:"variation-title"},We={key:0},Je={class:"fc-popover-box-action"},Ge={key:0,class:"block w-full truncate mr-4"},Ke={key:1,class:"block w-full truncate mr-4"},Xe={class:"fc-popover-box-action-icon"},Ye=["innerHTML"],Ze=["innerHTML"],et=["innerHTML"],tt={class:"fc-status-group"},st=["src","alt"],ot={class:"fc-btn-group sm justify-end"},nt={class:"table-cell"},no={__name:"OrdersTable",props:{orders:{type:Array,required:!0},emptyText:{type:String,required:!1,default:i("No orders found.")},columns:{type:Array,required:!1,default(){return["selection","customer","actions","status","order_items"]}},table:Object},setup(_,{expose:f}){const d=_,k=R([]),x=w=>d.columns.includes(w),a=w=>F.get(window,"fluentCartAdminApp.payment_logos."+w),y=F.get(window,"fluentCartAdminApp.receipt_page_url",!1)||!1,p=w=>w?Y.appendQueryParams(window.fluentCartAdminApp.site_url,{"fluent-cart":"receipt",order_hash:w,download:1}):"",g=w=>w.filter(I=>I.payment_type!=="signup_fee"),M=w=>{k.value=w.map(I=>({id:I.id,parent_id:I.parent_id,invoice_no:I.invoice_no,status:I.status}))},h=()=>{d.table.fetch()},N=w=>{switch(w){case"payment":return i("Payment");case"subscription":return i("Subscription");case"renewal":return i("Renewal");default:H.headline(w)}};return f({selectedOrders:k}),(w,I)=>{const r=v("el-table-column"),l=v("router-link"),V=v("el-popover"),T=v("el-tag"),D=v("el-tooltip"),A=v("el-table");return t(),u("div",He,[k.value.length?(t(),$(qe,{key:0,"selected-orders":k.value,"on-complete":h},null,8,["selected-orders"])):b("",!0),s(A,{class:"w-full compact-table",data:_.orders,"tooltip-options":{popperClass:"fc-tooltip-long"},onSelectionChange:M},{empty:n(()=>[s(z,{icon:"Empty/Order","has-dark":"",text:_.emptyText},null,8,["text"])]),default:n(()=>[_.table&&_.table.data.showDeleteBulkAction?(t(),$(r,{key:0,type:"selection",width:"45"})):b("",!0),s(r,{width:140,label:c(i)("Date")},{default:n(m=>[s(q,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:m.row.id}}},{default:n(()=>[e("div",null,[e("div",{title:c(i)("Order ID: %s",m.row.id),class:"text-xs text-system-mid dark:text-gray-300 mb-0.5"},o(m.row.invoice_no),9,Be),s(Q,{"date-time":m.row.created_at,"with-time":!1},null,8,["date-time"])])]),_:2},1032,["to"])]),_:1},8,["label"]),x("customer")?(t(),$(r,{key:1,width:130,label:c(i)("Customer")},{default:n(m=>[m.row.customer?(t(),$(W,{key:0,customer:m.row.customer,"to-route":{name:"view_order",params:{order_id:m.row.id}}},null,8,["customer","to-route"])):(t(),u("span",je,o(c(i)("Customer Not Found")),1))]),_:1},8,["label"])):b("",!0),x("order_items")?(t(),$(r,{key:2,"min-width":200,label:c(i)("Items")},{default:n(m=>[e("div",Ee,[s(V,{placement:"bottom-start",width:360,trigger:"click"},{reference:n(()=>{var S;return[e("div",Je,[g(m.row.order_items).length===1?(t(),u("span",Ge,o((S=g(m.row.order_items)[0])==null?void 0:S.post_title),1)):(t(),u("span",Ke,o(c(X)(g(m.row.order_items).length))+" "+o(w.$t("items")),1)),e("div",Xe,[s(P,{name:"ChevronDown"})])])]}),default:n(()=>[e("div",Fe,[e("div",Ue,[e("div",ze,[(t(!0),u(L,null,E(g(m.row.order_items),S=>(t(),u("p",{key:S.id},[s(l,{class:"title",to:{name:"product_edit",params:{product_id:S==null?void 0:S.post_id}}},{default:n(()=>[C(o(S.post_title),1)]),_:2},1032,["to"]),e("span",Qe,[e("b",null,o(S.quantity),1),C(" x "+o(S.title),1)])]))),128)),g(m.row.order_items).length===0?(t(),u("p",We,o(c(i)("No products found!")),1)):b("",!0)])])])]),_:2},1024),s(q,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:m.row.id}}},{default:n(()=>I[0]||(I[0]=[e("span",null," ",-1)])),_:2,__:[0]},1032,["to"])])]),_:1},8,["label"])):b("",!0),s(r,{width:150,label:c(i)("Total")},{default:n(m=>[s(q,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:m.row.id}}},{default:n(()=>[parseInt(m.row.total_refund)?(t(),u(L,{key:1},[e("span",{class:"text-gray-700 line-through",innerHTML:c(B).formatNumber(m.row.total_amount,!0,!1,m.row.currency)},null,8,Ze),m.row.payment_status!="refunded"?(t(),u("span",{key:0,style:{"margin-left":"5px"},innerHTML:c(B).formatNumber(parseInt(m.row.total_amount)-parseInt(m.row.total_refund),!0,!1,m.row.currency)},null,8,et)):b("",!0)],64)):(t(),u("span",{key:0,innerHTML:c(B).formatNumber(m.row.total_amount,!0,!1,m.row.currency)},null,8,Ye))]),_:2},1032,["to"])]),_:1},8,["label"]),s(r,{width:150,label:c(i)("Payment Status")},{default:n(m=>[s(q,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:m.row.id}}},{default:n(()=>[e("div",tt,[s(j,{status:m.row.payment_status,"hide-icon":!0},null,8,["status"]),a(m.row.payment_method)?(t(),u("span",{key:0,class:G(["img",m.row.payment_method])},[e("img",{src:a(m.row.payment_method),alt:c(H).headline(m.row.payment_method)},null,8,st)],2)):(t(),$(T,{key:1,type:"info",round:"",size:"small",class:"capitalize"},{default:n(()=>[C(o(c(H).headline(m.row.payment_method)),1)]),_:2},1024))])]),_:2},1032,["to"])]),_:1},8,["label"]),x("status")?(t(),$(r,{key:3,width:120,label:c(i)("Status")},{default:n(m=>[s(q,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:m.row.id}}},{default:n(()=>[(t(),$(j,{status:m.row.status,"hide-icon":!0,key:m.row.id},null,8,["status"]))]),_:2},1032,["to"])]),_:1},8,["label"])):b("",!0),x("type")?(t(),$(r,{key:4,width:140,label:c(i)("Order Type")},{default:n(m=>[e("span",null,o(N(m.row.type)),1),s(Z,{order:m.row},null,8,["order"])]),_:1},8,["label"])):b("",!0),x("actions")&&c(y)?(t(),$(r,{key:5,width:"60",label:""},{default:n(m=>[e("div",ot,[e("div",nt,[s(D,{content:c(i)("View Invoice"),placement:"top","popper-class":"fc-tooltip"},{default:n(()=>[s(ne,{target:"_blank",href:p(m.row.uuid),size:"small",tag:"a",bg:"ghost"},{default:n(()=>[s(P,{name:"Print"})]),_:2},1032,["href"])]),_:2},1032,["content"])])])]),_:1})):b("",!0)]),_:1},8,["data"])])}}},lt={class:"fc-orders-table-mobile-wrap"},at={class:"fc-orders-table-mobile-header"},rt=["onClick"],it=["title"],ct={class:"flex items-center gap-3"},dt=["onClick"],ut=["innerHTML"],_t=["innerHTML"],mt=["innerHTML"],pt={key:0,class:"fc-order-table-actions-col"},ft={class:"el-dropdown-link"},ht=["href"],vt={key:0,class:"fc-orders-table-mobile-body"},bt={class:"fc-order-and-customer-info"},yt={key:0,class:"fc-order-table-customer-col"},gt={key:1},wt={key:1,class:"fc-order-table-order-items-col"},kt={class:"fc-popover-box"},$t={class:"fluent-cart-admin-pages"},Ct={class:"fc-popover-content relative overflow-x-auto"},xt={class:"fc-product-orders-items"},Ot={class:"variation-title"},Tt={key:0},St={class:"fc-popover-box-action"},Mt={key:0,class:"fc-order-count-text"},It={key:1,class:"fc-order-count-text"},Dt={class:"fc-popover-box-action-icon"},At=["onClick"],Nt={class:"fc-status-and-order-type-wrap"},Lt={class:"fc-order-table-payment-status-col"},Vt={class:"title"},Pt={class:"fc-status-group"},Rt=["src","alt"],qt={key:0,class:"fc-order-table-status-col"},Ht={class:"title"},Bt={key:1,class:"fc-order-table-order-type-col"},jt={class:"title"},Et={class:"type"},Ft={key:0,class:"py-6 text-center"},lo={__name:"OrdersTableMobile",props:{orders:{type:Array,required:!0},emptyText:{type:String,required:!1,default:i("No orders found.")},columns:{type:Array,required:!1,default(){return["selection","customer","actions","status","order_items"]}},table:Object},setup(_){const f=_,d=p=>f.columns.includes(p),k=p=>F.get(window,"fluentCartAdminApp.payment_logos."+p);F.get(window,"fluentCartAdminApp.receipt_page_url",!1);const x=p=>p?Y.appendQueryParams(window.fluentCartAdminApp.site_url,{"fluent-cart":"receipt",order_hash:p,download:1}):"",a=p=>p.filter(g=>g.payment_type!=="signup_fee"),y=p=>{switch(p){case"payment":return i("Payment");case"subscription":return i("Subscription");case"renewal":return i("Renewal");default:H.headline(p)}};return(p,g)=>{const M=v("el-dropdown-item"),h=v("el-dropdown-menu"),N=v("el-dropdown"),w=v("router-link"),I=v("el-popover"),r=v("el-tag");return t(),u("div",lt,[(t(!0),u(L,null,E(_.orders,(l,V)=>(t(),u("div",{key:l.id,class:"fc-orders-table-mobile-row"},[e("div",at,[e("div",{class:"fc-order-table-date-col",onClick:T=>p.$router.push({name:"view_order",params:{order_id:l.id}})},[s(Q,{class:"date","date-time":l.created_at,"with-time":!1},null,8,["date-time"]),g[0]||(g[0]=e("span",{class:"bullet"},"•",-1)),e("div",{title:c(i)("Order ID: %s",l.id),class:"invoice-no"},o(l.invoice_no),9,it)],8,rt),e("div",ct,[e("div",{class:"fc-order-table-total-col",onClick:T=>p.$router.push({name:"view_order",params:{order_id:l.id}})},[parseInt(l.total_refund)?(t(),u(L,{key:1},[e("span",{class:"text-gray-700 line-through",innerHTML:c(B).formatNumber(l.total_amount,!0,!1,l.currency)},null,8,_t),l.payment_status!="refunded"?(t(),u("span",{key:0,class:"ml-1",innerHTML:c(B).formatNumber(parseInt(l.total_amount)-parseInt(l.total_refund),!0,!1,l.currency)},null,8,mt)):b("",!0)],64)):(t(),u("span",{key:0,innerHTML:c(B).formatNumber(l.total_amount,!0,!1,l.currency)},null,8,ut))],8,dt),d("actions")?(t(),u("div",pt,[s(N,{trigger:"click","popper-class":"fc-dropdown"},{dropdown:n(()=>[s(h,null,{default:n(()=>[s(M,{class:"item-link"},{default:n(()=>[e("a",{target:"_blank",href:x(l.uuid)},[s(P,{name:"Print"}),C(" "+o(c(i)("View Invoice")),1)],8,ht)]),_:2},1024)]),_:2},1024)]),default:n(()=>[e("span",ft,[s(P,{name:"More",class:"w-1"})])]),_:2},1024)])):b("",!0)])]),d("customer")||d("order_items")?(t(),u("div",vt,[e("div",bt,[d("customer")?(t(),u("div",yt,[l.customer?(t(),$(W,{key:0,customer:l.customer,"to-route":{name:"view_order",params:{order_id:l.id}}},null,8,["customer","to-route"])):(t(),u("span",gt,o(c(i)("Customer Not Found")),1))])):b("",!0),d("order_items")?(t(),u("div",wt,[e("div",kt,[s(I,{placement:"bottom-start",width:360,trigger:"click"},{reference:n(()=>{var T;return[e("div",St,[a(l.order_items).length===1?(t(),u("span",Mt,o((T=a(l.order_items)[0])==null?void 0:T.post_title),1)):(t(),u("span",It,o(a(l.order_items).length)+" "+o(p.$t("items")),1)),e("div",Dt,[s(P,{name:"ChevronDown"})])])]}),default:n(()=>[e("div",$t,[e("div",Ct,[e("div",xt,[(t(!0),u(L,null,E(a(l.order_items),T=>(t(),u("p",{key:T.id},[s(w,{class:"title",to:{name:"product_edit",params:{product_id:T==null?void 0:T.post_id}}},{default:n(()=>[C(o(T.post_title),1)]),_:2},1032,["to"]),e("span",Ot,[e("b",null,o(T.quantity),1),C(" x "+o(T.title),1)])]))),128)),a(l.order_items).length===0?(t(),u("p",Tt,o(c(i)("No products found!")),1)):b("",!0)])])])]),_:2},1024)])])):b("",!0)])])):b("",!0),e("div",{class:"fc-orders-table-mobile-footer",onClick:T=>p.$router.push({name:"view_order",params:{order_id:l.id}})},[e("div",Nt,[e("div",Lt,[e("div",Vt,o(c(i)("Payment Status")),1),e("div",Pt,[s(j,{status:l.payment_status,"hide-icon":!0},null,8,["status"]),k(l.payment_method)?(t(),u("span",{key:0,class:G(["img",l.payment_method])},[e("img",{src:k(l.payment_method),alt:c(H).headline(l.payment_method)},null,8,Rt)],2)):(t(),$(r,{key:1,type:"info",round:"",size:"small",class:"capitalize"},{default:n(()=>[C(o(c(H).headline(l.payment_method)),1)]),_:2},1024))])]),d("status")?(t(),u("div",qt,[e("div",Ht,o(c(i)("Status")),1),(t(),$(j,{status:l.status,"hide-icon":!0,key:l.id},null,8,["status"]))])):b("",!0),d("type")?(t(),u("div",Bt,[e("div",jt,o(c(i)("Order Type")),1),e("span",Et,o(y(l.type)),1),s(Z,{order:l},null,8,["order"])])):b("",!0)])],8,At)]))),128)),_.orders.length===0?(t(),u("div",Ft,[s(z,{icon:"Empty/Order","has-dark":"",text:_.emptyText},null,8,["text"])])):b("",!0)])}}},Ut={key:0,class:"text"},zt={class:"font-medium"},Qt=["innerHTML"],Wt={class:"purchase-values"},Jt=["innerHTML"],Gt={key:1},Kt=["innerHTML"],Xt={key:1,class:"text"},ao={__name:"CustomerPurchaseValue",props:{value:{type:[Object,String],required:!0}},setup(_){const f=_,d=J(()=>{if(typeof f.value=="string")try{return JSON.parse(f.value)}catch{return{}}return f.value&&typeof f.value=="object"?f.value:{}}),k=J(()=>{const a=Object.entries(d.value||{});if(!a.length)return{currency:"",value:0};const[y,p]=a[0];return{currency:y,value:p}}),x=J(()=>Object.entries(d.value||{}).slice(1).map(([y,p])=>({currency:y,value:p})));return(a,y)=>{const p=v("el-popover");return Object.keys(d.value).length?(t(),u("span",Ut,[x.value.length?(t(),$(p,{key:0,placement:"bottom",trigger:"hover","popper-class":"fc-popover"},{reference:n(()=>[e("span",zt,[e("span",{innerHTML:a.formatNumber(k.value.value,!0,!1,k.value.currency)},null,8,Qt),C(" +"+o(x.value.length),1)])]),default:n(()=>[e("div",Wt,[(t(!0),u(L,null,E(x.value,(g,M)=>(t(),u("div",{key:g.currency,class:"purchase-value-item"},[e("span",{innerHTML:a.formatNumber(g.value,!0,!1,g.currency)},null,8,Jt)]))),128))])]),_:1})):(t(),u("span",Gt,[e("span",{innerHTML:a.formatNumber(k.value.value,!0,!1,k.value.currency)},null,8,Kt)])),C(" "+o(c(i)("Lifetime Value")),1)])):(t(),u("span",Xt,o(c(i)("Lifetime Value"))+": "+o(c(i)("No Data")),1))}}},Yt={name:"SubscriptionsTable",emits:["fetch"],props:{subscriptions:{type:Array,required:!0},columns:{type:Array,required:!1,default(){return["customer","next_billing_date","collection_method","bills_count","payment_method","valid_till"]}}},components:{ConvertedTime:Q,RouteCell:q,Badge:j,DynamicIcon:P,ArrowDown:ee,Empty:z,CustomerInfoPopover:W},computed:{Str(){return H}},methods:{translate:i,subscriptionStatus(_){return _==null?void 0:_.status}}},Zt={class:"fc-subscriptions-table-wrap"},es={key:1},ts={class:"truncate"},ss=["innerHTML"];function os(_,f,d,k,x,a){const y=v("RouteCell"),p=v("el-table-column"),g=v("CustomerInfoPopover"),M=v("Badge"),h=v("ConvertedTime"),N=v("router-link"),w=v("Empty"),I=v("el-table");return t(),u("div",Zt,[s(I,{data:d.subscriptions,class:"w-full compact-table","tooltip-options":{popperClass:"fc-tooltip-long"}},{empty:n(()=>[s(w,{icon:"Empty/ListView","has-dark":!0,text:a.translate("No subscriptions found.")},null,8,["text"])]),default:n(()=>[s(p,{fixed:"",label:a.translate("ID"),width:"100"},{default:n(r=>{var l;return[s(y,{class:"link block",to:{name:"view_subscription",params:{subscription_id:(l=r.row)==null?void 0:l.id}}},{default:n(()=>[C(" #"+o(r.row.id),1)]),_:2},1032,["to"])]}),_:1},8,["label"]),d.columns.indexOf("customer")!==-1?(t(),$(p,{key:0,label:a.translate("Customer"),width:150},{default:n(r=>{var l;return[r.row.customer?(t(),$(g,{key:0,customer:r.row.customer,"to-route":{name:"view_subscription",params:{subscription_id:(l=r.row)==null?void 0:l.id}}},null,8,["customer","to-route"])):(t(),u("span",es,o(a.translate("Customer Not Found")),1))]}),_:1},8,["label"])):b("",!0),s(p,{label:a.translate("Product"),width:"360","show-overflow-tooltip":""},{default:n(r=>{var l;return[s(y,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(l=r.row)==null?void 0:l.id}}},{default:n(()=>[e("div",ts,o(r.row.item_name),1)]),_:2},1032,["to"])]}),_:1},8,["label"]),s(p,{label:a.translate("Status"),width:"120"},{default:n(r=>{var l;return[s(y,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(l=r.row)==null?void 0:l.id}}},{default:n(()=>[(t(),$(M,{status:a.subscriptionStatus(r.row),key:r.row.id,size:"small","hide-icon":!0},null,8,["status"]))]),_:2},1032,["to"])]}),_:1},8,["label"]),s(p,{label:a.translate("Billing"),width:"230"},{default:n(r=>{var l;return[s(y,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(l=r.row)==null?void 0:l.id}}},{default:n(()=>[e("span",{innerHTML:r.row.payment_info},null,8,ss)]),_:2},1032,["to"])]}),_:1},8,["label"]),s(p,{label:a.translate("Created At"),width:"130"},{default:n(r=>{var l;return[s(y,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(l=r.row)==null?void 0:l.id}}},{default:n(()=>[s(h,{"date-time":r.row.created_at,"with-time":!1},null,8,["date-time"])]),_:2},1032,["to"])]}),_:1},8,["label"]),d.columns.indexOf("next_billing_date")!==-1?(t(),$(p,{key:1,label:a.translate("Next Billing Date"),width:"160"},{default:n(r=>{var l;return[s(y,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(l=r.row)==null?void 0:l.id}}},{default:n(()=>[s(h,{"date-time":r.row.next_billing_date,"with-time":!1},null,8,["date-time"])]),_:2},1032,["to"])]}),_:1},8,["label"])):b("",!0),d.columns.indexOf("collection_method")!==-1?(t(),$(p,{key:2,label:a.translate("Collection Method"),width:"160"},{default:n(r=>{var l;return[s(y,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(l=r.row)==null?void 0:l.id}}},{default:n(()=>[C(o(r.row.collection_method),1)]),_:2},1032,["to"])]}),_:1},8,["label"])):b("",!0),d.columns.indexOf("bills_count")!==-1?(t(),$(p,{key:3,label:a.translate("Bills Count"),width:"100"},{default:n(r=>[C(o(r.row.bill_count),1)]),_:1},8,["label"])):b("",!0),d.columns.indexOf("payment_method")!==-1?(t(),$(p,{key:4,label:a.translate("Payment Method"),width:"150"},{default:n(r=>[C(o(r.row.current_payment_method?a.Str.headline(r.row.current_payment_method.trim().replace(/_/g,"-")):"-"),1)]),_:1},8,["label"])):b("",!0),d.columns.indexOf("order_id")!==-1?(t(),$(p,{key:5,label:a.translate("Order ID"),width:"100"},{default:n(r=>[s(N,{class:"link",to:{name:"view_order",params:{order_id:r.row.parent_order_id}}},{default:n(()=>[C(" #"+o(r.row.parent_order_id),1)]),_:2},1032,["to"])]),_:1},8,["label"])):b("",!0)]),_:1},8,["data"])])}const ro=te(Yt,[["render",os]]),ns={name:"SubscriptionsTableMobile",emits:["fetch"],props:{subscriptions:{type:Array,required:!0},columns:{type:Array,required:!1,default(){return["customer","next_billing_date","collection_method","bills_count","payment_method","valid_till"]}}},components:{ConvertedTime:Q,RouteCell:q,Badge:j,DynamicIcon:P,ArrowDown:ee,Empty:z,CustomerInfoPopover:W},computed:{Str(){return H}},methods:{translate:i,subscriptionStatus(_){return _==null?void 0:_.status}}},ls={class:"fc-table-mobile-wrap fc-subscriptions-table-mobile-wrap"},as=["onClick"],rs={class:"fc-table-mobile-header-left"},is={class:"fc-table-status-col"},cs={class:"fc-table-id-col"},ds={class:"id"},us={class:"fc-table-mobile-body"},_s={key:0,class:"fc-table-customer-col"},ms=["onClick"],ps={class:"fc-table-product-col"},fs={class:"product-name"},hs={class:"fc-table-billing-col"},vs={class:"title"},bs=["innerHTML"],ys={class:"fc-table-mobile-footer"},gs={class:"fc-table-mobile-footer-row cols-3"},ws=["onClick"],ks={class:"title"},$s=["onClick"],Cs={class:"title"},xs=["onClick"],Os={class:"title"},Ts={class:"value"},Ss=["onClick"],Ms={class:"title"},Is={class:"value"},Ds=["onClick"],As={class:"title"},Ns={class:"value"},Ls=["onClick"],Vs={class:"title"},Ps={class:"value"},Rs={key:0,class:"py-6 text-center"};function qs(_,f,d,k,x,a){const y=v("Badge"),p=v("CustomerInfoPopover"),g=v("ConvertedTime"),M=v("Empty");return t(),u("div",ls,[(t(!0),u(L,null,E(d.subscriptions,(h,N)=>(t(),u("div",{key:h.id,class:"fc-table-mobile-row"},[e("div",{class:"fc-table-mobile-header",onClick:w=>_.$router.push({name:"view_subscription",params:{subscription_id:h.id}})},[e("div",rs,[e("div",is,[(t(),$(y,{status:a.subscriptionStatus(h),key:h.id},null,8,["status"]))]),e("div",cs,[e("div",ds,"#"+o(h.id),1)])])],8,as),e("div",us,[d.columns.indexOf("customer")!==-1?(t(),u("div",_s,[s(p,{customer:h.customer,"to-route":{name:"view_subscription",params:{subscription_id:h==null?void 0:h.id}}},null,8,["customer","to-route"])])):b("",!0),e("div",{onClick:w=>_.$router.push({name:"view_subscription",params:{subscription_id:h.id}})},[e("div",ps,[e("div",fs,o(h.item_name),1)]),e("div",hs,[e("div",vs,o(a.translate("Billing:")),1),e("span",{innerHTML:h.payment_info},null,8,bs)])],8,ms)]),e("div",ys,[e("div",gs,[e("div",{class:"fc-table-created-at-col",onClick:w=>_.$router.push({name:"view_subscription",params:{subscription_id:h.id}})},[e("div",ks,o(a.translate("Created At")),1),s(g,{class:"value","date-time":h.created_at,"with-time":!1},null,8,["date-time"])],8,ws),d.columns.indexOf("next_billing_date")!==-1?(t(),u("div",{key:0,class:"fc-table-next-bill-date-col",onClick:w=>_.$router.push({name:"view_subscription",params:{subscription_id:h.id}})},[e("div",Cs,o(a.translate("Next Billing")),1),s(g,{class:"value","date-time":h.next_billing_date,"with-time":!1},null,8,["date-time"])],8,$s)):b("",!0),d.columns.indexOf("bills_count")!==-1?(t(),u("div",{key:1,class:"fc-table-bill-count-col",onClick:w=>_.$router.push({name:"view_subscription",params:{subscription_id:h.id}})},[e("div",Os,o(a.translate("Bills Count")),1),e("div",Ts,o(h.bill_count),1)],8,xs)):b("",!0),d.columns.indexOf("payment_method")!==-1?(t(),u("div",{key:2,class:"fc-table-payment-method-col",onClick:w=>_.$router.push({name:"view_subscription",params:{subscription_id:h.id}})},[e("div",Ms,o(a.translate("Payment Method")),1),e("div",Is,o(h.current_payment_method?a.Str.headline(h.current_payment_method.trim().replace(/_/g,"-")):"-"),1)],8,Ss)):b("",!0),d.columns.indexOf("order_id")!==-1?(t(),u("div",{key:3,class:"fc-table-order-id-col",onClick:w=>_.$router.push({name:"view_order",params:{order_id:h.parent_order_id}})},[e("div",As,o(a.translate("Order ID")),1),e("div",Ns,"#"+o(h.parent_order_id),1)],8,Ds)):b("",!0),d.columns.indexOf("collection_method")!==-1?(t(),u("div",{key:4,class:"fc-table-collection-method-col",onClick:w=>_.$router.push({name:"view_subscription",params:{subscription_id:h.id}})},[e("div",Vs,o(a.translate("Collection")),1),e("div",Ps,o(h.collection_method),1)],8,Ls)):b("",!0)])])]))),128)),d.subscriptions.length===0?(t(),u("div",Rs,[s(M,{icon:"Empty/ListView","has-dark":"",text:a.translate("No subscriptions found.")},null,8,["text"])])):b("",!0)])}const io=te(ns,[["render",qs]]),Hs={class:"dialog-footer"},Bs={name:"CancelSubscription",props:["subscription","orderId","modelValue"],data(){return{cancelReason:"customer_request",cancelling:!1,otherReason:""}},computed:{updatedModelValue:{get(){return this.modelValue},set(_){this.modelValue=_}},otherReasonError(){return this.cancelReason==="other"&&this.otherReason.trim()===""?i("Please enter a reason"):""}},methods:{cancelSubscription(){if(this.cancelling=!0,this.cancelReason==="other"){if(this.otherReason.trim()===""){this.$notify.error(i("Please enter a reason")),this.cancelling=!1;return}this.cancelReason=this.otherReason}this.$put(`orders/${this.orderId}/subscriptions/${this.subscription.id}/cancel`,{cancel_reason:this.cancelReason}).then(_=>{this.cancelling=!0,this.$notify({type:"success",title:i("Success"),message:i("Subscription canceled successfully")}),this.$emit("reload")}).catch(_=>{var f;this.cancelling=!0,_.status_code=="422"?U.validationErrors(_):U.error((f=_.data)==null?void 0:f.message)}).finally(()=>{this.cancelling=!0,this.cancelSubscriptionModal=!1})}}},co=Object.assign(Bs,{setup(_){return(f,d)=>{const k=v("el-option"),x=v("el-select"),a=v("el-form-item"),y=v("el-input"),p=v("el-form"),g=v("el-button"),M=v("el-dialog");return t(),$(M,{"model-value":f.updatedModelValue,loading:f.cancelling,title:c(i)("Cancel Subscription"),width:"500"},{footer:n(()=>[e("div",Hs,[s(g,{onClick:d[2]||(d[2]=h=>f.$emit("close"))},{default:n(()=>[C(o(c(i)("Cancel")),1)]),_:1}),s(g,{loading:f.cancelling,type:"warning",onClick:f.cancelSubscription},{default:n(()=>[C(o(c(i)("Cancel Subscription")),1)]),_:1},8,["loading","onClick"])])]),default:n(()=>[s(p,{"label-position":"top"},{default:n(()=>[e("div",null,o(c(i)("Are you sure to cancel the subscription?")),1),d[3]||(d[3]=e("br",null,null,-1)),s(a,{label:c(i)("Cancellation reason"),required:""},{default:n(()=>[s(x,{modelValue:f.cancelReason,"onUpdate:modelValue":d[0]||(d[0]=h=>f.cancelReason=h)},{default:n(()=>[s(k,{label:c(i)("Refunded"),value:"refunded"},null,8,["label"]),s(k,{label:c(i)("Customer request"),value:"customer_request"},null,8,["label"]),s(k,{label:c(i)("Completed (EOT)"),value:"completed"},null,8,["label"]),s(k,{label:c(i)("Fraudulent"),value:"fraudulent"},null,8,["label"]),s(k,{label:c(i)("Other"),value:"other"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),f.cancelReason==="other"?(t(),$(a,{key:0,label:c(i)("Other Reason"),required:"",error:f.otherReasonError},{default:n(()=>[s(y,{modelValue:f.otherReason,"onUpdate:modelValue":d[1]||(d[1]=h=>f.otherReason=h)},null,8,["modelValue"])]),_:1},8,["label","error"])):b("",!0)]),_:1,__:[3]})]),_:1},8,["model-value","loading","title"])}}});export{io as S,Q as _,no as a,lo as b,ao as c,ro as d,co as e};
